[{"count": 187, "commit_pairs": {"CLOUDSTACK-10382": {"fixed_bug_sha": "3af54ec1a8313c51c0faf98bf41e99450a3d0079", "parent_bug_sha": "8798014ca8ce921bcaec747291c36fbbd1ab6b7e", "commit_message": "CLOUDSTACK-10382: Fix cloud-get-vm-data-configdrive.in (#2688)"}, "CLOUDSTACK-10377": {"fixed_bug_sha": "8798014ca8ce921bcaec747291c36fbbd1ab6b7e", "parent_bug_sha": "9b83337658ede7f55bc404f869ae996d929ae9cb", "commit_message": "CLOUDSTACK-10377: Fix Network restart for Nuage (#2672)\n\nChanges in PR #2508 have caused network restart to fail in a Nuage setup,\r\nas the new VR takes the same IP as the old one, and the old VR is still running.\r\nNuage doesn't support multiple VM's having the same IP.\r\nWe delay provisioning the interfaces in VSD until the old VR interface is released."}, "CLOUDSTACK-10375": {"fixed_bug_sha": "5221778aa4e74d3531995987907d8ce20d22a9ce", "parent_bug_sha": "eb23d91cf465c13e79e7b612258e9614669de7c9", "commit_message": "CLOUDSTACK-10375: Don't create DefaultNuageVspSharedNetworkOfferingWithSGService (#2667)"}, "CLOUDSTACK-10276": {"fixed_bug_sha": "8b09620d777805bdbb59255ef722e0a6ddbb85b8", "parent_bug_sha": "02ece533755282e7d8f4610157b5d9febd199784", "commit_message": "CLOUDSTACK-10276: listVolumes not working when storage UUID is not a UUID (#2639)\n\nWhen configuring a pre-setup primary storage we can enter the name-label of the storage that is going to be used by ACS and is already set up in the host. The problem is that we can use any String of characters there, and this String does not need to be a UUID. When listing volumes from a primary storage that has such conditions, the list will return all of the volumes in the cloud because the \u201cAPI framework\u201d will ignore that value as it is not a UUID type."}, "CLOUDSTACK-10290": {"fixed_bug_sha": "acc5fdcdbd613bedfcd0ca867123e2cd3ba8d5c6", "parent_bug_sha": "f23278a4381d57ac167835d2ff625dc4d61978fd", "commit_message": "CLOUDSTACK-10290: allow config drives on primary storage for KVM (#2651)\n\nThis introduces a new global setting `vm.configdrive.primarypool.enabled` to toggle creation/hosting of config drive iso files on primary storage, the default will be false causing them to be hosted on secondary storage. The current support is limited from hypervisor resource side and in current implementation limited to `KVM` only. The next big change is that config drive is created at a temporary location by management server and shipped to either KVM or SSVM agent via cmd-answer pattern, the data of which is not logged in logs. This saves us from adding genisoimage dependency on cloudstack-agent pkg.\r\n\r\nThe APIs to reset ssh public key, password and user-data (via update VM API) requires that VM should be shutdown. Therefore, in the refactoring I removed the case of updation of existing ISO. If there are objections I'll re-put the strategy to detach+attach new config iso as a way of updation. In the refactored implementation, the folder name is changed to lower-cased configdrive. And during VM start, migration or shutdown/removal if primary storage is enable for use, the KVM agent will handle cleanup tasks otherwise SSVM agent will handle them.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-9184": {"fixed_bug_sha": "1b3046e3767a5e2a989ae7a47d35289cec3f06bf", "parent_bug_sha": "a77ed56b86e94e376a2d45f4e7e6d72bd6155b82", "commit_message": "CLOUDSTACK-9184: Fixes #2631 VMware dvs portgroup autogrowth (#2634)\n\n* CLOUDSTACK-9184: Fixes #2631 VMware dvs portgroup autogrowth\r\n\r\nThis deprecates the vmware.ports.per.dvportgroup global setting.\r\n\r\nThe vSphere Auto Expand feature (introduced in vSphere 5.0) will take\r\ncare of dynamically increasing/decreasing the dvPorts when running out\r\nof distributed ports . But in case of vSphere 4.1/4.0 (If used), as this\r\nfeature is not there, the new default value (=> 8) have an impact in the\r\nexisting deployments. Action item for vSphere 4.1/4.0: Admin should\r\nmodify the global configuration setting \"vmware.ports.per.dvportgroup\"\r\nfrom 8 to any number based on their environment because the proposal\r\ndefault value of 8 would be very less without auto expand feature in\r\ngeneral. The current default value of 256 may not need immediate\r\nmodification after deployment, but 8 would be very less which means\r\nadmin need to update immediately after upgrade.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-9114": {"fixed_bug_sha": "a77ed56b86e94e376a2d45f4e7e6d72bd6155b82", "parent_bug_sha": "bd8976010835acaa690c85775d0504a4ff8df894", "commit_message": "CLOUDSTACK-9114: Reduce VR downtime during network restart (#2508)\n\nThis introduces a rolling restart of VRs when networks are restarted\r\nwith cleanup option for isolated and VPC networks. A make redundant option is\r\nshown for isolated networks now in UI.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10147": {"fixed_bug_sha": "c3488a51db4bce4ec32c09e6fef78193d360cf3f", "parent_bug_sha": "521e71fbeb35f591df5752271c3714c8e556864a", "commit_message": "CLOUDSTACK-10147 Disabled Xenserver Cluster can still deploy VM's. Added code to skip disabled clusters when selecting a host (#2442)"}, "CLOUDSTACK-10376": {"fixed_bug_sha": "10a10f625b6e52cf0dd1dc3f8505083ed51dde75", "parent_bug_sha": "05857c717d8bc0bb151f6a7d231d6862c6ebf483", "commit_message": "CLOUDSTACK-10376: UI: Create VPC Offering does not show ConfigDrive as UserData provider"}, "CLOUDSTACK-9781": {"fixed_bug_sha": "1ff171db902b98df5d172ae468c33a07ea1204d5", "parent_bug_sha": "d94a5bea3c3f826fc53d8a555bd69714546e025d", "commit_message": "CLOUDSTACK-9781: record resource uuid in events instead of integer id (#1940)\n\nThis changes several event logging to use uuid of resource than integer id when creating API events."}, "CLOUDSTACK-10253": {"fixed_bug_sha": "586edec7ac3e0b56de5a243ede08564a534f4f89", "parent_bug_sha": "e4537e9d39f72bb807f473fef42d9401145a60c8", "commit_message": "CLOUDSTACK-10253: JSON response for SuccessResponse as boolean instead of string (#2428)\n\n* JSON response for SuccessResponse as boolean instead of string\r\n\r\nSigned-off-by: Marc-Aur\u00e8le Brothier <m@brothier.org>\r\n\r\n* Fixing test cases"}, "CLOUDSTACK-10288": {"fixed_bug_sha": "85203248a4bf8a4c09742ba1c4ae236ee008a15f", "parent_bug_sha": "b6d420bec3b4cb02651cffd43502ed880f100bef", "commit_message": "ConfigDrive fixes: CLOUDSTACK-10288, CLOUDSTACK-10289 (#2566)\n\n* CLOUDSTACK-10289: Config Drive Metadata: Use VM UUID instead of VM id\r\n\r\n* CLOUDSTACK-10288: Config Drive Userdata: support for binary userdata\r\n\r\n* CLOUDSTACK-10358: SSH keys are missing on Config Drive disk in some cases"}, "CLOUDSTACK-10356": {"fixed_bug_sha": "4c42aafae0d3286a38d796a7c69a6aec6810cf79", "parent_bug_sha": "efcd24c2a2cdc5d04b3f6d424305288b1cf88852", "commit_message": "[CLOUDSTACK-10356] Fix NPE in Cloudstack found with NPEDetector  (#2573)\n\n* fix https://issues.apache.org/jira/browse/CLOUDSTACK-10356\r\n\r\n* del patch file\r\n\r\n* Update ResourceCountDaoImpl.java\r\n\r\n* fix some format\r\n\r\n* fix code\r\n\r\n* fix error message in VolumeOrchestrator\r\n\r\n* add check null stmt\r\n\r\n* del import unuse class\r\n\r\n* use BooleanUtils to check Boolean\r\n\r\n* fix error message\r\n\r\n* delete unuse function\r\n\r\n* delete the deprecated function  updateDomainCount\r\n\r\n* add error log and throw exception in ProjectManagerImpl.java"}, "CLOUDSTACK-10327": {"fixed_bug_sha": "9a13227a78acb14d9fd4f9ad5246ce67396cef7a", "parent_bug_sha": "ea55a002cf9669b70ac47bdbe270dd78301bc328", "commit_message": "CLOUDSTACK-10327: Do not invalidate the session when an API command is not available (#2498)\n\nCloudStack SSO (using security.singlesignon.key) does not work anymore with CloudStack 4.11, since commit 9988c26, which introduced a regression due to a refactoring: every API request that is not \"validated\" generates the same error (401 - Unauthorized) and invalidates the session.\r\n\r\nHowever, CloudStack UI executes a call to listConfigurations in method bypassLoginCheck. A non-admin user does not have the permissions to execute this request, which causes an error 401:\r\n\r\n{\"listconfigurationsresponse\":{\"uuidList\":[],\"errorcode\":401,\"errortext\":\"unable to verify user credentials and/or request signature\"}}\r\nThe session (already created by SSO) is then invalidated and the user cannot access to CloudStack UI (error \"Session Expired\").\r\n\r\nBefore 9988c26 (up to CloudStack 4.10), an error 432 was returned (and ignored):\r\n\r\n{\"errorresponse\":{\"uuidList\":[],\"errorcode\":432,\"cserrorcode\":9999,\"errortext\":\"The user is not allowed to request the API command or the API command does not exist\"}}\r\nEven if the call to listConfigurations was removed, another call to listIdps also lead to an error 401 for user accounts if the SAML plugin is not enabled.\r\n\r\nThis pull request aims to fix the SSO issue, by restoring errors 432 (instead of 401 + invalidate session) for commands not available. However, if an API command is explicitly denied using ACLs or if the session key is incorrect, it still generates an error 401 and invalidates the session."}, "CLOUDSTACK-9593": {"fixed_bug_sha": "a26a5023458b8b95779409fb231ad12badacc8a8", "parent_bug_sha": "391952da5bd522e44e0a17723c6ec77254a76353", "commit_message": "CLOUDSTACK-9593: userdata: enforce data is a multiple of 4 characters (#1760)\n\nPython base64 requires that the string is a multiple of 4 characters but\r\nthe Apache codec does not. RFC states is not mandatory so the data should\r\nnot fail the VR script (vmdata.py).\r\n\r\nSigned-off-by: Marc-Aur\u00e8le Brothier <m@brothier.org>\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10175": {"fixed_bug_sha": "2ab5ab1c90191307e2b8a9576aad91670e2ac09c", "parent_bug_sha": "d95ba438f66d81fd8320a75f12d8f50d41c96e1c", "commit_message": "CLOUDSTACK-10175: Prevent VPC list leakage if project=-1 specified on API (#2352)\n\nThis PR fixes the issue in which there's a leak when doing API call for listing VPC with domain account and projectId=-1.\r\nNote for reviewers: The code formatting changed so many lines in the commit but the actual change is in line 2467-2471."}, "CLOUDSTACK-10208": {"fixed_bug_sha": "d95ba438f66d81fd8320a75f12d8f50d41c96e1c", "parent_bug_sha": "7544ebe2485b8280aeaf5dd247aa584835f45684", "commit_message": "CLOUDSTACK-10208: Fix snmptrap alert bug (#2045)\n\nFix snmptrap alerts info omit to send the field of SnmpConstants.sysUpTime\r\nFix SnmpConstants.sysUpTime expression\r\nRemove unused import java.util.Date"}, "CLOUDSTACK-10166": {"fixed_bug_sha": "290a8bc1c2b6af7871ac66faf31cd667ace45bd0", "parent_bug_sha": "e0d5364b700f907f3965447b83f3f6f3d292d4de", "commit_message": "CLOUDSTACK-10166: Get accountId and domainId from VPC when tagging a NetworkACL as a user (#2347)\n\nThis fixes the issue that a non-root user cannot tag a network ACL item\r\nand after the fix a non-root user still cannot tag a globally defined\r\nACL item and only the ACLs they have access to."}, "CLOUDSTACK-9456": {"fixed_bug_sha": "e0d5364b700f907f3965447b83f3f6f3d292d4de", "parent_bug_sha": "f8a31b09c78ce6b3dcad9e52771554e404cd0285", "commit_message": "CLOUDSTACK-9456: Upgrade spring and misc dependencies (#2375)\n\nUpgrades spring, jetty and misc dependencies\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10013": {"fixed_bug_sha": "2aa70eecceb94c6c6dc6f89889b1b3cdd7b25dc8", "parent_bug_sha": "78bb74188dd4d8c81930eedd021492b9f346ec32", "commit_message": "CLOUDSTACK-10013: Make Debian9 systemvmtemplates work with systemd\n\n- Load the nf_conntrack_ipv6 module for IPv6 connection tracking on SSVM\n- Move systemd services to /etc and enable services after they have been\n  installed\n- Disable most services by default and enable in cloud-early-config\n- Start services after enabling them using systemd\n- In addition remove /etc/init.d/cloud as this is no longer needed and\n  done by systemd\n- Accept DOS/MBR as file format for ISO images as well\n\nUnder Debian 7 the 'file' command would return:\n\n  debian-9.1.0-amd64-netinst.iso: ISO 9660 CD-ROM filesystem data UDF filesystem data\n\nUnder Debian 9 however it will return\n\n  debian-9.1.0-amd64-netinst.iso: DOS/MBR boot sector\n\nThis would make the HTTPTemplateDownloader in the Secondary Storage VM refuse the ISO as\na valid template because it's not a correct format.\n\nChanges this behavior so that it accepts both.\nThis allows us to use Debian 9 as a System VM template.\n\nNot sure though if enabling them is enough for systemd to still start them\non first boot\n\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-9348": {"fixed_bug_sha": "d0005d83536f1da3778547f81a7ee8289e5bb510", "parent_bug_sha": "893f2af31f6513ab9833823446815de0fd97b9ca", "commit_message": "CLOUDSTACK-9348: Improve Nio SSH handshake buffers\n\nUse a holder class to pass buffers, fixes potential leak.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10194": {"fixed_bug_sha": "3839239a21fc14a64acc18900ae303961036ef91", "parent_bug_sha": "60a216bcc94ff12ee9100362393cae8ce8ba4792", "commit_message": "CLOUDSTACK-10194: Use packer for building systemvmtemplates\n\n- This migrates the current systemvmtemplate build system from\n  veewee/virtualbox to packer and qemu based.\n- This also introduces and updates a CentOS7 built-in template.\n- Remove old appliance build scripts and files.\n- Adds iftop package (CLOUDSTACK-9785)\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10001": {"fixed_bug_sha": "68b3b4436a9a4a7648d04d3528b58b64353fb5fb", "parent_bug_sha": "0b43cd91bbe90d733977fefd0a5dfe9ba73285b5", "commit_message": "CLOUDSTACK-10001: Fix incorrect total host memory in responses\n\nThis fixes incorrect total host memory in listHosts and related host\nresponses, regression introduced in #2120.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10010": {"fixed_bug_sha": "d943eb916b683ab4e777e1d4956b3cb65dc3d9a5", "parent_bug_sha": "8c53574c911e46798c191409186ef67261511728", "commit_message": "CLOUDSTACK-10010: Port marvin test from #2190 by @swill\n\nThis ports the S2S config test by @swill from #2190 with additional\nchanges to make robust and environment agnostic.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-7853": {"fixed_bug_sha": "893f2af31f6513ab9833823446815de0fd97b9ca", "parent_bug_sha": "bb965649d90768d27b55105de882873863bb8012", "commit_message": "CLOUDSTACK-7853: Fix ping timeout edge case and refactor code\n\nRefresh InaccurateClock every 10seconds, refactor code to get ping timeout\nand ping interval.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-9953": {"fixed_bug_sha": "ce3303212b5f9639ee91db52972fc9fd4b9a3c68", "parent_bug_sha": "6ab46b3c29c167a3d8a08828bc754c383648404b", "commit_message": "CLOUDSTACK-9953: Resize root disk for VMware when full clone is enabled\n\nResize for VMware root disk should only be performed during VM start\nwhen vmware.create.full.clone is true i.e. the disk chain length is one.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10193": {"fixed_bug_sha": "60a216bcc94ff12ee9100362393cae8ce8ba4792", "parent_bug_sha": "15b11a3b27800afcb598f8e97416f0d826cac491", "commit_message": "CLOUDSTACK-10193: Use other64Linux for systemvms on VMware\n\nIn default/fresh installations, the guest os type for systemvms with id=15\nor Debian 5 (32-bit) can cause memory allocation issues to guest. Using\nOther Linux 64-bit as guest OS systemvms get all the allocated RAM. This\navoids OOM related kernel panics for certain VRs such as rVRs, lbvm etc.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10187": {"fixed_bug_sha": "6fc389a044288e8f12f41a651a711a1ab7113b86", "parent_bug_sha": "facc5945f0e5081c166dd5a979c9ebb50dfa5562", "commit_message": "CLOUDSTACK-10187: Don't delete vifs for VPCs with source nat\n\nOn XenServer, both redundant router's vifs were getting deleted when any\nPF rule is removed from any of the acquired public IPs. This fix\nensures that lastIp is set to `false` when processed by hypervisor\nresources to avoid removing of VIFs when VPCs have any source nat IP.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10129": {"fixed_bug_sha": "a1008f9ae28cf664bb5a26b109332baf3425b6df", "parent_bug_sha": "475aa03bb858d2cf1b6c0d7aaaf35fbb1fb43d1d", "commit_message": "CLOUDSTACK-10129: Show account, network info in VR list view (#2327)\n\nThis shows the owner account and network of a VR in the VR list view,\r\nand for VPCs shows the VPC name and redundant state of the VPC rVR.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-9595": {"fixed_bug_sha": "1edb3e8a450079e9f027f159ee7b8fa31e39b591", "parent_bug_sha": "3c6df7c97089fd0171b903bb0dffb8fa5f81c550", "commit_message": "CLOUDSTACK-9595: Avoiding the deadlocks in the code (#1762)\n\nMySQLTransactionRollbackException is seen frequently in logs\r\nRoot Cause\r\nAttempts to lock rows in the core data access layer of database fails if there is a possibility of deadlock. However Operations are not getting retried in case of deadlock. So introducing retries here\r\nSolution\r\nOperations would be retried after some wait time in case of dead lock exception."}, "CLOUDSTACK-10215": {"fixed_bug_sha": "981286f93cd79d0583637ee806b0faf674bf39fc", "parent_bug_sha": "8442a4d9dfcfdd7bb92e9039a7923f1c3915fddf", "commit_message": "CLOUDSTACK-10215: Excessive log4j debug level in CPVM could lead to FS overflow (#2391)\n\nFixed excessive log levels for systemvm agents."}, "CLOUDSTACK-9921": {"fixed_bug_sha": "8442a4d9dfcfdd7bb92e9039a7923f1c3915fddf", "parent_bug_sha": "4d7a9d82cc2df041c59a6d126b8b5d5228b3de5d", "commit_message": "CLOUDSTACK-9921: Fix NPE when storage garbage collector is running (#2139)\n\nSteps to reproduce issue\r\n\r\nDeploy a VM\r\nTake snapshot of the root volume\r\nDelete the snapshot\r\nBefore the garbage collector has run, shutdown the VM and assign the VM to other user.\r\nWhen garage collector executes NPE shows in the logs."}, "CLOUDSTACK-9892": {"fixed_bug_sha": "4d7a9d82cc2df041c59a6d126b8b5d5228b3de5d", "parent_bug_sha": "25d7d741a7a80fa615c576fda6248e1f1a28dafe", "commit_message": "CLOUDSTACK-9892: Primary storage resource check is broken when using root disk size override to deploy VM (#2088)\n\nThis happens when the root disk size is overridden. The primary storage limit check should be performed based on overridden size instead of template size. Enabled root disk resize tests to run on simulator as well."}, "CLOUDSTACK-10197": {"fixed_bug_sha": "c3e5c09ac6bfecedbdd831acba0e8fbcb5d4d3d5", "parent_bug_sha": "f2efbcececb3cfb06a51e5d3a2e77417c19c667f", "commit_message": "[CLOUDSTACK-10197] Update DisplayText of XenServer tools ISO entry in the database when it already exists (#2470)\n\n* Update the displayText of XenServer ISO when it already exist in the DB\r\n\r\nBesides updating the ISO display text, I also created unit test cases for 'createXenServerToolsIsoEntryInDatabase' and 'getActualIsoTemplate' methods.\r\n\r\n* Formatting and cleanups for checkstyle of changed classes"}, "CLOUDSTACK-9896": {"fixed_bug_sha": "92a6bc27ff862be72de7f96a2e836d6bb66a353c", "parent_bug_sha": "1ade09575e1f1457c8a0e54c722fadc158635af6", "commit_message": "CLOUDSTACK-9896: listDedicatedXXX should respect pagination (#2073)\n\nFixes listDedicatedxxx APIs to respect pagination options."}, "CLOUDSTACK-9632": {"fixed_bug_sha": "1ade09575e1f1457c8a0e54c722fadc158635af6", "parent_bug_sha": "90ef67bab993c95b253cc810fb0b67fe8d6fc6e8", "commit_message": "CLOUDSTACK-9632: Upgrade bountycastle to v1.59 (#2386)\n\nUpgrades bountycastle to v1.59.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10117": {"fixed_bug_sha": "5eb09565b390e82072423e9d8b06b7af23884927", "parent_bug_sha": "cfff78d9a114dca8f0552503a68bade83a7faeaa", "commit_message": "CLOUDSTACK-10117: Allow scoped setting to have nullable values (#2413)\n\nAllows scope setting for domain_details to have nullable values."}, "CLOUDSTACK-9025": {"fixed_bug_sha": "1d0f2128f62ff32b9cff27f6de1ed711563b656b", "parent_bug_sha": "b16dcb7174cc493efc92f0960a8cac1d59c11b67", "commit_message": "[CLOUDSTACK-9025][CLOUDSTACK-10128] solve problems of templates created based on snapshots (#2315)\n\nThe first PR(#1176) intended to solve #CLOUDSTACK-9025 was only tackling the problem for CloudStack deployments that use single hypervisor types (restricted to XenServer). Additionally, the lack of information regarding that solution (poor documentation, test cases and description in PRs and Jira ticket) led the code to be removed in #1124 after a long discussion and analysis in #1056. That piece of code seemed logicless (and it was!).  It would receive a hostId and then change that hostId for other hostId of the zone without doing any check; it was not even checking the hypervisor and storage in which the host was plugged into.\r\n\r\nThe problem reported in #CLOUDSTACK-9025 is caused by partial snapshots that are taken in XenServer. This means, we do not take a complete snapshot, but a partial one that contains only the modified data. This requires rebuilding the VHD hierarchy when creating a template out of the snapshot. The point is that the first hostId received is not a hostId, but a system VM ID(SSVM). That is why the code in #1176 fixed the problem for some deployment scenarios, but would cause problems for scenarios where we have multiple hypervisors in the same zone. We need to execute the creation of the VHD that represents the template in the hypervisor, so the VHD chain can be built using the parent links.\r\n\r\nThis commit changes the method com.cloud.hypervisor.XenServerGuru.getCommandHostDelegation(long, Command). From now on we replace the hostId that is intended to execute the \u201ccopy command\u201d that will create the VHD of the template according to some conditions that were already in place. The idea is that starting with XenServer 6.2.0 hotFix ESP1004 we need to execute the command in the hypervisor host and not from the SSVM. Moreover, the method was improved making it readable and understandable; it was also created test cases assuring that from XenServer 6.2.0 hotFix ESP1004 and upward versions we change the hostId that will be used to execute the \u201ccopy command\u201d.\r\n\r\nFurthermore, we are not selecting a random host from a zone anymore. A new method was introduced in the HostDao called \u201cfindHostConnectedToSnapshotStoragePoolToExecuteCommand\u201d, using this method we look for a host that is in the cluster that is using the storage pool where the volume from which the Snaphost is taken of. By doing this, we guarantee that the host that is connected to the primary storage where all of the snapshots parent VHDs are stored is used to create the template.\r\n\r\nConsider using Disabled hosts when no Enabled hosts are found\r\n\r\nThis also closes #2317"}, "CLOUDSTACK-10096": {"fixed_bug_sha": "b16dcb7174cc493efc92f0960a8cac1d59c11b67", "parent_bug_sha": "5fad84174a199f798396fcacedae2c56bdcc2bba", "commit_message": "CLOUDSTACK-10096 Can't reset integration.api.port and usage.sanity.check.interval (#2274)\n\nFix for CLOUDSTACK-7931 enforces a valid integer value to be configured for integration.api.port and usage.sanity.check.interval. These global configs can't be reset back to null(default)."}, "CLOUDSTACK-10104": {"fixed_bug_sha": "5fad84174a199f798396fcacedae2c56bdcc2bba", "parent_bug_sha": "bf4f1bbb90a7ac05c7d40b1e5667186a646a25f7", "commit_message": "CLOUDSTACK-10104: Optimize database transactions in ListDomain API to improve performance (#2282)\n\nWhile creating the response object for the 'listDomain' API, several database calls are triggered to fetch details like parent domain, project limit, IP limit, etc. These database calls are triggered for each record found in the main fetch query, which is causing the response to slow down.\r\n\r\nFix:\r\nThe database transactions are reduced to improve response of the Listdomain API"}, "CLOUDSTACK-10211": {"fixed_bug_sha": "b26d798868f120567252753e27915a73ea9dac6b", "parent_bug_sha": "72539690882490d44c23bef5412e3bccd93df258", "commit_message": "CLOUDSTACK-10211: Fixed test_nuage_public_sharednetwork_userdata tests (#2385)"}, "CLOUDSTACK-10065": {"fixed_bug_sha": "72539690882490d44c23bef5412e3bccd93df258", "parent_bug_sha": "ebb7a5279d0bf5d538081e6ec34fa46d76d40b8f", "commit_message": "CLOUDSTACK-10065: Optimize SQL queries in listTemplate API to improve performance (#2260)\n\nThe db queries in listTemplateAPI could be optimized to get unique results from the database which could help in reducing the listTemplate API response time."}, "CLOUDSTACK-9572": {"fixed_bug_sha": "8eca04e1f6bbe5410dfd657588a67b2b2f71a411", "parent_bug_sha": "053b12c813f72f2bce3934f7ac757c752d5e2666", "commit_message": " CLOUDSTACK-9572: Snapshot on primary storage not cleaned up after Storage migration (#1740)\n\nSnapshot on primary storage not cleaned up after Storage migration. This happens in the following scenario:\r\n\r\nSteps To Reproduce\r\nCreate an instance on the local storage on any host\r\nCreate a scheduled snapshot of the volume:\r\nWait until ACS created the snapshot. ACS is creating a snapshot on local storage and is transferring this snapshot to secondary storage. But the latest snapshot on local storage will stay there. This is as expected.\r\nMigrate the instance to another XenServer host with ACS UI and Storage Live Migration\r\nThe Snapshot on the old host on local storage will not be cleaned up and is staying on local storage. So local storage will fill up with unneeded snapshots."}, "CLOUDSTACK-9908": {"fixed_bug_sha": "053b12c813f72f2bce3934f7ac757c752d5e2666", "parent_bug_sha": "dd21f68926f7fb65a65318618479e7f9e7874da2", "commit_message": "CLOUDSTACK-9908: Primary Storage allocated capacity goes very high after VM snapshot (#2104)\n\nAdded '-' chracter while reading Filenames so that filename match exactly with VM name."}, "CLOUDSTACK-10205": {"fixed_bug_sha": "8131bccd979d764cbab44705dd7f1d9539fd06ef", "parent_bug_sha": "d7e334b1b4aa39c35bc6029c1e5b0f050c097a78", "commit_message": "CLOUDSTACK-10205: LinkDomainToLdap returns UUID instead of internal id (#2378)\n\nThe internal id is not usefull to the user. It is a bug to return it instead of a uuid.\r\nIn the process of fixing the above \"name\" was deprecated in favour of \"ldap_domain\"."}, "CLOUDSTACK-9599": {"fixed_bug_sha": "d7e334b1b4aa39c35bc6029c1e5b0f050c097a78", "parent_bug_sha": "25b63f5e737aba00067e39ee0003f4b52713d6d6", "commit_message": "CLOUDSTACK-9599: isdynamicallyscalable field missing in updateTemplate Response (#2383)\n\nUsing cloudmonkey, when invoking the update template api call, it does not display the isdynamicallyscalable field as part of its template response.\r\nfix done:\r\norg.apache.cloudstack.api.response.TemplateResponse isdynamicallyscalable field is now populated in the server/src/com/cloud/api/query/dao/TemplateJoinDaoImpl.java.newUpdateResponse method.\r\nUnit test:\r\nthe Unit test server/test/com/cloud/api/query/dao/TemplateJoinDaoImplTest.java testNewUpdateResponse() verifies that the TemplateResponse is populated correctly.\r\nMarvin test:\r\nthe Marvin nosetest integration/smoke/test_templates.py test_02_edit_template(self) confirms that the template_response.isdynamicallyscalable field gets populated with the correct user data.\r\nTest scenario:\r\nUsing cloudmonkey, when invoking the 'update template' API call, it should now display the isdynamicallyscalable field as part of its template response."}, "CLOUDSTACK-9607": {"fixed_bug_sha": "25b63f5e737aba00067e39ee0003f4b52713d6d6", "parent_bug_sha": "9988c269b259b84c0b8436bad17f88dbc1d706e7", "commit_message": "CLOUDSTACK-9607: Preventing template deletion when template is in use (#1773)\n\nConsider this scenario:\r\n1. User launches a VM from Template and keep it running\r\n2. Admin logins and deleted that template [CloudPlatform does not check existing / running VM etc. while the deletion is done]\r\n3. User resets the VM\r\n4. CloudPlatform fails to star the VM as it cannot find the corresponding template.\r\n\r\nIt throws error as \r\njava.lang.RuntimeException: Job failed due to exception Resource [Host:11] is unreachable: Host 11: Unable to start instance due to can't find ready template: 209 for data center 1\r\nat com.cloud.vm.VmWorkJobDispatcher.runJob(VmWorkJobDispatcher.java:113)\r\nat org.apache.cloudstack.framework.jobs.impl.AsyncJobManagerImpl$5.runInContext(AsyncJobManagerImpl.java:495)\r\n\r\nClient is requesting better handing of this scenario. We need to check existing / running VM's when the template is deleted and warn admin about the possible issue that may occur.\r\n\r\nREPRO STEPS\r\n==================\r\n1. Launches a VM from Template and keep it running\r\n2. Now delete that template \r\n3. Reset the VM\r\n4. CloudPlatform fails to star the VM as it cannot find the corresponding template.\r\n\r\nEXPECTED BEHAVIOR\r\n==================\r\nCloud platform should throw some warning message while the template is deleted if that template is being used by existing / running VM's\r\n\r\nACTUAL BEHAVIOR\r\n==================\r\nCloud platform does not throw as waring etc."}, "CLOUDSTACK-9932": {"fixed_bug_sha": "2adbaeb64128d1b911efc20ee6a2c3a9cdae1eda", "parent_bug_sha": "000ee36224feb81fb86da2ffebb812f4d3d1e35a", "commit_message": "CLOUDSTACK-9932: Snapshot is getting deleted while volume creation from the snapshot is in progress (#2149)\n\nAdded validation to check if any volume(s) are in creating state , before performing delete snapshot."}, "CLOUDSTACK-9971": {"fixed_bug_sha": "000ee36224feb81fb86da2ffebb812f4d3d1e35a", "parent_bug_sha": "c436bc3ef93bd8fa1cf87ba7c6abcdaf490ddeef", "commit_message": "CLOUDSTACK-9971: Bugfix/listaccounts parameter consistency (#2156)\n\nRan into an issue today where we passed both the \"id\" and \"domainid\" parameters into \"listAccounts\" and received a response despite the account id passed not belonging to the domainid passed.\r\n\r\nAllow usage of \"domainid\" AND \"id\" in \"listAccounts\"\r\n- Adding \"AccountDoa::findActiveAccountById\"\r\n- Adding \"AccountDaoImpl::findActiveAccountById\"\r\n- Removing seemingly pointless \"listForDomain\" parameter\r\n- Updating \"typeNEQ\" value from \"5\" to \"Account.ACCOUNT_TYPE_PROJECT\"\r\n  (which is \"5\")\r\n- Only attempt to load domain for \"path\" query parameter once\r\n\r\n\"searchForAccountsInternal\" input validation logic pseudo-code:\r\n  - If \"domainid\" set, check immediately\r\n  - If \"id\" not set:\r\n    - and user is admin and \"listall\" is true\r\n      - if \"domainid\" not set, use caller domain id\r\n      - force \"isrecursive\" true\r\n    - else use caller account id\r\n  - Else if \"domainid\" and \"name\" set\r\n    - verify existence of account and that user has access\r\n  - Else:\r\n    - if \"domainid\" not set, locate account by \"id\"\r\n    - else, locate account by \"id\" and \"domainid\"\r\n    - verify account found and caller has access rights"}, "CLOUDSTACK-10202": {"fixed_bug_sha": "36f43b5d53e7720d10217ada2c5b926a833dd6bb", "parent_bug_sha": "67f509dc5768a1a7ad2a64dbe2e30c56fe8bd429", "commit_message": "CLOUDSTACK-10202: createSnapshotPolicy API create multiple entries in DB for same volume. (#2373)\n\ncreateSnapshotPolicy API create multiple entries in DB for same parameters, if multiple threads are executed in parallel.\r\n\r\nSTEPS TO REPRODUCE :\r\n\r\nCreated a new machine having root and data disk.\r\nMake sure that no existing snapshot policy is present for the volume.\r\nExecute multiple threads in parallel for createSnapshotPolicy API having all required parameters exactly same.\r\nVerify table snapshot_policy in DB, will get multiple entries for same policy.\r\nOnce again execute same multiple threads, by changing any API parameter, will see that existing entries are getting modified in DB and no new entries are added."}, "CLOUDSTACK-10163": {"fixed_bug_sha": "67f509dc5768a1a7ad2a64dbe2e30c56fe8bd429", "parent_bug_sha": "6724a471222daec41c8c9bfff709aee9db0a9880", "commit_message": "CLOUDSTACK-10163: Component tests sanity (#2344)\n\nFixing some component tests and adding them in travis.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10177": {"fixed_bug_sha": "be3a39ea4fcb1f758d72c4e4abc43f428845c4d1", "parent_bug_sha": "637d9a62c54a7b6eac939d7569fcafc0d2a075bd", "commit_message": "CLOUDSTACK-10177: Only pass IPv6 address to Security Group Python script if present (#2355)\n\nOtherwise we send down a 'null' to a ProcessBuilder in Java instead of a String and this\r\ncauses a NPE.\r\n\r\nWe should check first if the Instance has a IPv6 address before sending it there.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-10070": {"fixed_bug_sha": "ef4adb3672403b9611531d40e7b2cdf25ccc624d", "parent_bug_sha": "919d298630ea5f9ae4ebb60aff4799efdad3ed8d", "commit_message": "CLOUDSTACK-10070: Fixing some component tests and adding them in travis (#2263)\n\n- Fixing some component tests and adding them in travis\r\n- Rearranges tests in .travis.yml file\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-7793": {"fixed_bug_sha": "ed6e3be756f9f292d5a38fc24ce90e798e066371", "parent_bug_sha": "8f35657ac2dcf774a556075406332d6e84615639", "commit_message": "CLOUDSTACK-7793: Create Snaphot with quiesce option set to true fails with InvalidParameterValueException (#2312)\n\nreate Snaphot with quiesce option set to true fails with InvalidParameterValueException\r\n\r\n--quiescevm option is only supported with netapp plugin with vmware. When netapp is not there, they would be struck in Allocated state and Deletion is not supported in allocated state. To fix this issue, deletion is supported in allocated state as well."}, "CLOUDSTACK-10164": {"fixed_bug_sha": "8f35657ac2dcf774a556075406332d6e84615639", "parent_bug_sha": "ef4adb3672403b9611531d40e7b2cdf25ccc624d", "commit_message": "CLOUDSTACK-10164: allow users to create a VPC through the UI. (#2345)\n\nThe listNuageVspDomainTemplat cmd was called by the ui when the create vpc dialog was opened. This command failed when no nuage vsp device was present. As a consequence the ui did not show the dialog. So currently it's not possible to create a vpc through the UI with a native CloudStack deployment. This bugfix, adds robustness to the ui that in case the cmd fails the dialog will appear nonetheless . Furthermore I also changed the listNuageVspDomainTemplateCmd to always return an empty result when there is no nuage zone."}, "CLOUDSTACK-9586": {"fixed_bug_sha": "919d298630ea5f9ae4ebb60aff4799efdad3ed8d", "parent_bug_sha": "e2aee99623ddd92cb9602ba3e9f1bf639d7f6b53", "commit_message": "CLOUDSTACK-9586: Adding local storage test (#2342)\n\nAdded local storage test. Result:\r\n==== Marvin Init Successful ====Host id fc9fa94f-7c78-41d0-b38c-6f5bfdf22571, hypervisor XenServer, localstorage False\r\nHost id b54ccd0f-cd3c-4367-b9b4-f7d370b71670, hypervisor XenServer, localstorage True\r\nTemplate id b8d66364-d5a0-11e7-8e52-06ca2801075c is Ready True\r\nPrepare Template result [{domain : u'ROOT', domainid : u'b8d2a14e-d5a0-11e7-8e52-06ca2801075c', ostypename : u'CentOS 5.6 (64-bit)', zoneid : u'daf11016-d38b-4dae-aad1-b46bfefbd5e6', displaytext : u'CentOS 5.6(64-bit) no GUI (XenServer)', ostypeid : u'b8f78667-d5a0-11e7-8e52-06ca2801075c', passwordenabled : False, id : u'b8d66364-d5a0-11e7-8e52-06ca2801075c', size : 21474836480, isready : True, format : u'VHD', templatetype : u'BUILTIN', bits : 0, zonename : u'trl-1082-x-cs411-bstoyanov', status : u'Download Complete', isdynamicallyscalable : True, tags : [], isfeatured : True, sshkeyenabled : False, isextractable : True, crossZones : True, account : u'system', name : u'CentOS 5.6(64-bit) no GUI (XenServer)', created : u'2017-11-30T07:57:42+0000', hypervisor : u'XenServer', ispublic : True, checksum : u'905cec879afd9c9d22ecc8036131a180', physicalsize : 1758786048}]\r\n=== TestName: test_01_prepare_template_local_storage | Status : SUCCESS ==="}, "CLOUDSTACK-9432": {"fixed_bug_sha": "bd5604428be5713f47f10db93019193d144ce745", "parent_bug_sha": "bec48c62b6282e3f94af3b0d150a628052a98672", "commit_message": "Merge pull request #2124 from GabrielBrascher/CLOUDSTACK-9432\n\nCLOUDSTACK-9432: cluster/host dedicated to a domain is owned by the root domain"}, "CLOUDSTACK-10140": {"fixed_bug_sha": "bec48c62b6282e3f94af3b0d150a628052a98672", "parent_bug_sha": "f506a99df53b498291d38a1cebe13fc436f09220", "commit_message": " CLOUDSTACK-10140: Fix for when template is created from snapshot template.properties are corrupted (#2322)\n\nFix for when template is created from snapshot template.properties are corrupted"}, "CLOUDSTACK-10154": {"fixed_bug_sha": "f506a99df53b498291d38a1cebe13fc436f09220", "parent_bug_sha": "fdf250906066e63fb89ee1ab62efc1b6f70b94c1", "commit_message": "CLOUDSTACK-10154: fixing some smoketests failures (#2335)\n\n* CLOUDSTACK-10154: fixing some smoketests failures\r\n\r\n* Adding wait_until pattern to test_volumes"}, "CLOUDSTACK-10160": {"fixed_bug_sha": "fdf250906066e63fb89ee1ab62efc1b6f70b94c1", "parent_bug_sha": "d65f0447aefb69aaf849bb53cd3de289e2f1efed", "commit_message": "CLOUDSTACK-10160: Fix typo in Libvirt XML definition for Virtio-SCSI (#2341)\n\n* CLOUDSTACK-10160: Fix typo in Libvirt XML definition for Virtio-SCSI\r\n\r\nThe attribute for the XML element 'controller' should be 'model' and\r\nnot 'mode'.\r\n\r\nSource: https://libvirt.org/formatdomain.html#elementsControllers\r\n\r\n  A scsi controller has an optional attribute model, which is one of\r\n  'auto', 'buslogic', 'ibmvscsi', 'lsilogic', 'lsisas1068', 'lsisas1078',\r\n  'virtio-scsi' or 'vmpvscsi'.\r\n\r\nIn the current state a regular SCSI device is attached and not a Virtio-SCSI\r\ndevice.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>\r\n\r\n* CLOUDSTACK-10160: Add UnitTest for LibvirtVMDef.SCSIDef\r\n\r\nTo make sure the XML output string is correct\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-10138": {"fixed_bug_sha": "d65f0447aefb69aaf849bb53cd3de289e2f1efed", "parent_bug_sha": "88327580b08e2abec2d3c817ab0336e394563cd6", "commit_message": "CLOUDSTACK-10138: Load br_netfilter in security_group management script (#2321)\n\nImproved debian installation script to find either rb_netfilter module exists in the system and should be loaded. The implementation does check and fix during installation process (Ubuntu 14.04/16.04)"}, "CLOUDSTACK-10152": {"fixed_bug_sha": "88327580b08e2abec2d3c817ab0336e394563cd6", "parent_bug_sha": "cb9c7adddf11c859852c4cd5e4e3013b482c317e", "commit_message": "CLOUDSTACK-10152: Skip the destination cidr in ipset when 0.0.0.0/0 pa\u2026 (#2334)\n\nSkip the destination cidr in ipset when 0.0.0.0/0 passed.\r\nFixed adding issue with egress dest cidr with 0.0.0.0/0."}, "CLOUDSTACK-10133": {"fixed_bug_sha": "421517f949dcded5d06f0930289271e70b3e11f3", "parent_bug_sha": "fd7eeb4848043bdd11086af56ce0bc3703a6abd8", "commit_message": "CLOUDSTACK-10133: Local storage overprovisioning for ext file system (#2310)\n\nLocal storage overprovisioning for ext file system"}, "CLOUDSTACK-10123": {"fixed_bug_sha": "421f1072d521af20acacfd13eb427f6f0aa02731", "parent_bug_sha": "cd6288ecfb64cfbc6cecd869beb576945c0d5d08", "commit_message": "CLOUDSTACK-10123: Entity should use GMT TZ for timestamp values (#2303)\n\nDepending on the timezone you're running CS (before GMT timezones) you could experience that some jobs are marked as failed since the parent job got a null result despite its child job having successfully done the job. The child job got deleted by the CleanupTask ahead of time, due to a missing datetime conversion to GMT timezone.\r\n\r\nJobs are failing with this message: Job failed with un-handled exception\r\n\r\nThe fix intends to correct any datetime used in the code that should be using the GMT timezone instead of the local one since all DB datetime should be stored at GMT."}, "CLOUDSTACK-10012": {"fixed_bug_sha": "a37204079847d5f7aba03f05378a8c6a8a902f5e", "parent_bug_sha": "49be7eecd2e7db33a421b8680e4e8806a3d63952", "commit_message": "CLOUDSTACK-10012: Load SQL schema scripts from JAR (#2247)\n\nLoad SQL schema scripts from the uber/fat JAR. This also removes the setup/db/db directory from centos packaging."}, "CLOUDSTACK-10144": {"fixed_bug_sha": "55c059c09887651cab59e292bedafbbf9f1699df", "parent_bug_sha": "7f6ae15972fde879bb13efce105f9cca515b638f", "commit_message": "CLOUDSTACK-10144: fix possible NPE in listVlanIpRanges"}, "CLOUDSTACK-9450": {"fixed_bug_sha": "14ab69e19a51886b91d77d01eed96de05eb21393", "parent_bug_sha": "a1008f9ae28cf664bb5a26b109332baf3425b6df", "commit_message": "Merge pull request #2005 from nuagenetworks/feature/nw_offering_for_vpc\n\nCLOUDSTACK-9450: Network Offering for VPC based on DB flag"}, "CLOUDSTACK-10135": {"fixed_bug_sha": "60bec39b9ddb72c9badda49dc39c4105596bcb90", "parent_bug_sha": "3ee8d83621c23f976413fdce6d9245197497d504", "commit_message": "CLOUDSTACK-10135 ACL rules order is not maintained for ACL_OUTBOUND in VPC VR (#2313)"}, "CLOUDSTACK-10136": {"fixed_bug_sha": "3ee8d83621c23f976413fdce6d9245197497d504", "parent_bug_sha": "9c067c0496ef9671c8c0e46b6d3722aa460ac352", "commit_message": "CLOUDSTACK-10136: Fix RemoteHostEndPoint thread growth\n\nThis fixes the following:\n- Unchecked thread growth in RemoteEndHostEndPoint\n- Potential NPE while finding EP for a storage/scope\n\nUnbounded thread growth can be reproduced with following findings:\n- Every unreachable template would produce 6 new threads (in a single\nScheduledExecutorService instance) spaced by 10 seconds\n- Every reachable template url without the template would produce 1 new\nthread (and one ScheduledExecutorService instance), it errors out quickly without\ncausing more thread growth.\n- Every valid url will produce upto 10 threads as the same ep (endpoint\ninstance) will be reused to query upload/download (async callback)\nprogresses.\n\nEvery RemoteHostEndPoint instances creates its own\nScheduledExecutorService instance which is why in the jstack dump, we\nsee several threads that share the prefix RemoteHostEndPoint-{1..10}\n(given poolsize is defined as 10, it uses suffixes 1-10).\n\nThis fixes the discovered thread leakage with following notes:\n- Instead of ScheduledExecutorService instance, a cached pool could be\nused instead and was implemented, and with `static` scope to be reused\namong other future RemoteHostEndPoint instances.\n- It was not clear why we would want to wait when we've Answers returned\nfrom the remote EP, and therefore a scheduled/delayed Runnable was\nnot required at all for processing answers. ScheduledExecutorService\nwas therefore not really required, moved to ExecutorService instead.\n- Another benefit of using a cached pool is that it will shutdown\nthreads if they are not used in 60 seconds, and they get re-used for\nfuture runnable submissions.\n- Caveat: the executor service is still unbounded, however, the use-case\nthat this method is used for short jobs to check upload/download\nprogresses fits the case here.\n- Refactored CmdRunner to not use/reference objects from parent class.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10137": {"fixed_bug_sha": "9c067c0496ef9671c8c0e46b6d3722aa460ac352", "parent_bug_sha": "4af82bbc5c338cef74a7f295be251c67ca21411e", "commit_message": "CLOUDSTACK-10137: Only link log4j if not already present (#2316)\n\nUse ln -sf to add link log4j.xml.\r\n\r\nSigned-off-by: Marc-Aur\u00e8le Brothier <m@brothier.org>"}, "CLOUDSTACK-10239": {"fixed_bug_sha": "6aadbc521950964b86d2912c874800cead1b7496", "parent_bug_sha": "22d6718fe3f83d6c3c47734669fe9cde3e6d1a88", "commit_message": "CLOUDSTACK-10239: Fallback to default provider if needed (#2430)\n\nFallback to default provider if needed."}, "CLOUDSTACK-10255": {"fixed_bug_sha": "22d6718fe3f83d6c3c47734669fe9cde3e6d1a88", "parent_bug_sha": "170b6ce20dd4fc2f1fd3ad84833f440d955d2987", "commit_message": "CLOUDSTACK-10255: Fix agent logrotate (#2429)\n\nRenamed cloudstack-agent.logrotate to cloudstack-agent.logrotate.in,\r\nso Ant will run the filterchain while copying.\r\nThis made the ant run copy block of cloudstack-agent.logrotate unnecessary,\r\nso this is removed."}, "CLOUDSTACK-10236": {"fixed_bug_sha": "170b6ce20dd4fc2f1fd3ad84833f440d955d2987", "parent_bug_sha": "61a5a297058ce4478766b36d640f76684e31b9c8", "commit_message": "CLOUDSTACK-10236: Enable dynamic roles for missing props file (#2426)\n\nAutomate dynamic roles migration for missing props file\r\n\r\n- In case commands.properties file is missing, enables dynamic roles.\r\n- Adds a new -D or --default flag to migrate-dynamicroles.py script\r\n  to simply update the global setting and use the default role-rule\r\n  permissions.\r\n- Add warning message, ask admins to move to dynamic roles during upgrade\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10252": {"fixed_bug_sha": "61a5a297058ce4478766b36d640f76684e31b9c8", "parent_bug_sha": "f80f00ebcb6c626a004c2b528b4026710f01e794", "commit_message": "CLOUDSTACK-10252: Delete dnsmasq leases file on restart (#2427)\n\nDelete dnsmasq's leases file when dnsmasq is restarted to avoid it\r\nuse old ip-mac-address-vm mapping leases.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10242": {"fixed_bug_sha": "f80f00ebcb6c626a004c2b528b4026710f01e794", "parent_bug_sha": "3b23d5af740b57acd7745d4475fb2a5877bbf043", "commit_message": "CLOUDSTACK-10242: Properly parse incoming rules to Sec Group (#2418)\n\nWith merge of PR #2028 the separator for lines to the Security Group\r\nPython script changed from : to ; to support IPv6 addresses.\r\n\r\nThis broke certain situations where rules were parsed improperly. This\r\ncommit fixes the issue.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10245": {"fixed_bug_sha": "3b23d5af740b57acd7745d4475fb2a5877bbf043", "parent_bug_sha": "2ca264ca4d78d89f7f190d6e4c6af81f5f3d7569", "commit_message": "CLOUDSTACK-10245: Fix password server regression (#2419)\n\nIn case of isolated, both self.config.is_vpc() and self.config.is_router() are false,\r\nbut self.config.is_dhcp() is true.\r\nMoved the password server logic to the `if has_metadata` block,\r\nas this is valid for all 3 systemvm types."}, "CLOUDSTACK-10248": {"fixed_bug_sha": "c591c5ad3e270e5e62166a7f1ff6f9895d4b102c", "parent_bug_sha": "7e39961f22ab3157994fc075325287ecaf365d11", "commit_message": "CLOUDSTACK-10248: Fix errors that appeared after #2283 (#2417)\n\nThis fixes move refactoring error introduced in #2283 \r\nFor instance, the class DatadiskTO is supposed to be in com.cloud.agent.api.to package. However, the folder structure it was placed in is com.cloud.agent.api.api.to.\r\n\r\nSkip tests for cloud-plugin-hypervisor-ovm3:\r\nFor some unknown reason, there are quite a lot of broken test cases for cloud-plugin-hypervisor-ovm3. They might have appeared after some dependency upgrade and was overlooked by the person updating them. I checked them to see if they could be fixed, but these tests are not developed in a clear and clean manner. On top of that, we do not see (at least I) people using OVM3-hypervisor with ACS. Therefore, I decided to skip them.\r\n\r\nIdentention corrected to use spaces instead of tabs in XML files"}, "CLOUDSTACK-10244": {"fixed_bug_sha": "2ca264ca4d78d89f7f190d6e4c6af81f5f3d7569", "parent_bug_sha": "5eb09565b390e82072423e9d8b06b7af23884927", "commit_message": "CLOUDSTACK-10244: Cache whether to migrate storage (#2416)\n\nKVM online storage migration fails, this fixes use of whether to migrate storage using a cached variable."}, "CLOUDSTACK-10233": {"fixed_bug_sha": "cfff78d9a114dca8f0552503a68bade83a7faeaa", "parent_bug_sha": "a9fdb31585a1e3250fd3a4d1627c697d6f624018", "commit_message": "CLOUDSTACK-10233: Use namespace in Libvirt domain metadata. (#2410)\n\nThe documentation of Libvirt specifies the requirement of using an XML namespace,\r\nwhen having metadata in the Domain XML. The Nuage extenstion metadata was not\r\nadhering to this specification, and the lastest Libvirt version ignores it in that case."}, "CLOUDSTACK-9749": {"fixed_bug_sha": "a9fdb31585a1e3250fd3a4d1627c697d6f624018", "parent_bug_sha": "7d144e146a0ae58230398b93ce7cbdf6db180518", "commit_message": "CLOUDSTACK-9749: Fix Password server running on internal LB VM (#2409)\n\nFixes code to start password server only on routers."}, "CLOUDSTACK-10227": {"fixed_bug_sha": "48e6989da43a3ccc8f4e75d4a680f3aa0a99ba72", "parent_bug_sha": "535e6153cce89d213c53b89dc331f3e5ebc39211", "commit_message": "CLOUDSTACK-10227: Fix mkdir path for centos rpms (#2513)\n\nThis fixes the mkdir path `/usr/bin` for el6/7 rpms.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10220": {"fixed_bug_sha": "823a7891e4b55dca2a241f8ee8ce846469cf5c4a", "parent_bug_sha": "d84b268b4cb4704ac94ed5ba7c2b01651572489c", "commit_message": "CLOUDSTACK-10220: Configure IPv4 alias on VR regardless of IPv6 (#2396)\n\nIPv4 and IPv6 are two different protocols and the presence of IPv6\r\nin a network does not mean that IPv4 aliases/multiple subnets should\r\nnot be configured or supported by the VR.\r\n\r\nThis if-statement was written almost 5 years ago in a attempt to\r\nadd IPv6 support to CloudStack but was never fully implemented.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-10128": {"fixed_bug_sha": "e532b574ddb186a117da638fb6059356fe7c266c", "parent_bug_sha": "6233a77d15adde86302a11b2bcda604313833e91", "commit_message": "Forward merge #2402 merged on '4.11' branch\n\n[CLOUDSTACK-10128] Simplify the search for hosts to execute commands"}, "CLOUDSTACK-10188": {"fixed_bug_sha": "7ca4582a852ae874181188280cc654e8fed6bd65", "parent_bug_sha": "64832fd70afdde668ffe7be864d8015a89f96c6d", "commit_message": "CLOUDSTACK-10188 - Resource Accounting for primary storage is Broken when Domains are in use (#2362)\n\nDuring storage expunge domain resource statistics for primary storage space resource counter is not updated for domain. This leads to the situation when domain resource statistics for primary storage is overfilled (statistics only increase but not decrease).\r\n\r\nGlobal scheduled task resourcecount.check.interval > 0 provides a workaround but not fixes the problem truly because when accounts inside domains use primary_storage allocation/deallocation intensively it leads to service block of operation.\r\n\r\nNB: Unable to implement marvin tests because it (marvin) places in database weird primary storage volume size of 100 when creating VM from template. It might be a sign of opening a new issue for that bug."}, "CLOUDSTACK-10217": {"fixed_bug_sha": "e01dd89c930b6218e0062becf20e0dc594d00569", "parent_bug_sha": "c9afa8e5b4d3787f5212cc0205b86ded0c89a1d7", "commit_message": "CLOUDSTACK-10217: Clean up old MAC addresses from DHCP lease file (#2393)\n\nWhen the IPv4 address of a Instance changes we need to make sure the\r\nold entry is removed from the DHCP lease file on the Virtual Router\r\notherwise the Instance will still get the old lease.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-10212": {"fixed_bug_sha": "35b43399467737c23ec8d1b1337f1bcfb8e88aa1", "parent_bug_sha": "e86bb41e0e3facb250cdcb984a8f8f91bf052b2b", "commit_message": "CLOUDSTACK-10212: Update Netmask/Gateway when Changing IPv4 address (#2388)\n\nThis can otherwise cause problems in Basic Networking where multiple\r\nIPv4 ranges are configured in a POD.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-10146": {"fixed_bug_sha": "123c20dc57d809f89bc1b012303e71b6892c8729", "parent_bug_sha": "94776fbfd030528feccacdfc2d1ed85a38858f3f", "commit_message": "CLOUDSTACK-10146 checksum in java instead of script (#2405)\n\n* CLOUDSTACK-10146 checksum in java instead of script\r\n\r\n* root cause passing"}, "CLOUDSTACK-10305": {"fixed_bug_sha": "703054964a9bae27a563412c35166bae515d10e3", "parent_bug_sha": "cae32925608815f7defa76621ed9c6a23fab1cef", "commit_message": "CLOUDSTACK-10305: Rare race condition in KVM migration (#2466)\n\nThere is a race condition in the monitoring of the migration process on KVM. If the monitor wakes up in the tight window after the migration succeeds, but before the migration thread terminates, the monitor will get a LibvirtException \u201cDomain not found: no domain with matching uuid\u201d when checking on the migration status. This in turn causes CloudStack to sync the VM state to stop, in which it issues a defensive StopCommand to ensure it is correctly synced.\r\n\r\nFix: Prevent LibvirtException: \"Domain not found\" caused by the call to dm.getInfo()"}, "CLOUDSTACK-9338": {"fixed_bug_sha": "5d545023fcc4ea525012232182a250669975f24d", "parent_bug_sha": "cbb4b7939005113c092504c431cef10211c209ff", "commit_message": "[CLOUDSTACK-9338] ACS not accounting resources of VMs with custom service offering\n\nACS is accounting the resources properly when deploying VMs with custom service offerings. However, there are other methods (such as updateResourceCount) that do not execute the resource accounting properly, and these methods update the resource count for an account in the database. Therefore, if a user deploys VMs with custom service offerings, and later this user calls the \u201cupdateResourceCount\u201d method, it (the method) will only account for VMs with normal service offerings, and update this as the number of resources used by the account. This will result in a smaller number of resources to be accounted for the given account than the real used value. The problem becomes worse because if the user starts to delete these VMs, it is possible to reach negative values of resources allocated (breaking all of the resource limiting for accounts). This is a very serious attack vector for public cloud providers!"}, "CLOUDSTACK-10284": {"fixed_bug_sha": "37e5d3631640428263311991b2c29a219d39cc43", "parent_bug_sha": "f96398c127b5def0d8cc7a3cc7557d66cacba619", "commit_message": "CLOUDSTACK-10284:Creating a snapshot from VM Snapshot generates error if hypervisor is not KVM."}, "CLOUDSTACK-10283": {"fixed_bug_sha": "f1cf5f97e97558194a813119876f56bd55d0ff2a", "parent_bug_sha": "3109c590e3d69de83a114ed6fdb12b706e46a7f3", "commit_message": "CLOUDSTACK-10283: Sudo to setup agent keystore, fail on host add failure\n\nThis would make keystore utility scripts being executed as sudoer\nin case the process uid/owner is not root but still a sudoer user.\n\nAlso fails addHost while securing a KVM host and if keystore fails to be\nsetup for any reason.\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10293": {"fixed_bug_sha": "689715504c84dce65e3f9d5f834cd01e5284bad6", "parent_bug_sha": "f96398c127b5def0d8cc7a3cc7557d66cacba619", "commit_message": "[CLOUDSTACK-10293] Single view network ACL rules listing\n\nThe ACL rules editing/addition page is not user-friendly. Users are not able to see in a single view all of the detail of the ACL rule (they need to use a scroll bar on the horizontal). The problem becomes worse when there are a considerable number of rules. Therefore, we are proposing the following changes:\n\n1- Instead of using the table to create new ACL, we can create a button like the one presented in attached pictures, where users can click, and then a modal popup would appear and users would be able to create the new ACL there. This is similar to the workings of the ACL edit button.\n2 - Remove the ability to add new ACL via table where they are presented. All ACLs should be entered via the \u201cNew ACL\u201d button. Therefore, the section \u201cAdd ACL\u201d would be removed as well;\n3 - Move the action section of the list ACL table to the most left position;\n\nThese changes would reduce the information in the table and facilitate users to add new rules and easily edit them as well."}, "CLOUDSTACK-10299": {"fixed_bug_sha": "0bb20a7ed27865c01f81bca191e6347c32be9c4c", "parent_bug_sha": "5c2b8f80f02ae9459537b32ac2bece3e765032ef", "commit_message": "Merge pull request #2464 from resmo/fix/4.11/CLOUDSTACK-10299\n\n[4.11] CLOUDSTACK-10299: UI: fix error in network listing in project mode"}, "CLOUDSTACK-10282": {"fixed_bug_sha": "97441a82f96ae4f30fcd866a63e63c64a71ff04b", "parent_bug_sha": "3109c590e3d69de83a114ed6fdb12b706e46a7f3", "commit_message": "CLOUDSTACK-10282: ipv6 firewall rules operation should be done with ip6tables (#2450)\n\nFor ipv6 firewall rules operation should be done with ip6tables."}, "CLOUDSTACK-10285": {"fixed_bug_sha": "3109c590e3d69de83a114ed6fdb12b706e46a7f3", "parent_bug_sha": "dee5bb527e7aca4e72e2249b348cca6d688fbe5f", "commit_message": "CLOUDSTACK-10285: Fix db upgrade failure for 4.10.0.0 users (#2452)\n\n4.10.0.0 users when upgrade to 4.11.0.0 may face db related\r\ndiscrepancies due to some PRs that got merged without moving their sql\r\nchanges to 4.10->4.11 upgrade path. The 4.10.0.0 users can run those\r\nmissing sql statements manually and then upgrade to 4.11.0.0, since a\r\nworkaround like this is possible this ticket is not marked a blocker. In\r\n4.11.1.0+, we'll move those changes from 4.9.3.0->4.10.0.0 upgrade path\r\nto 4.10.0.0->4.11.0.0 upgrade path. Ideally we should not be doing this,\r\nbut this will fix issues for a future 4.10.0.0 user who may want to\r\nupgrade to 4.11.1.0 or 4.12.0.0+.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10261": {"fixed_bug_sha": "dee5bb527e7aca4e72e2249b348cca6d688fbe5f", "parent_bug_sha": "b2a19f7587fdd86fddc6c32fa8476eeac6269116", "commit_message": "CLOUDSTACK-10261: Libvirt metadata create only one nuage-extension xml tag (#2441)"}, "CLOUDSTACK-10247": {"fixed_bug_sha": "b2a19f7587fdd86fddc6c32fa8476eeac6269116", "parent_bug_sha": "6e09529bdee0be84cb435beef0735444b3f6f692", "commit_message": "CLOUDSTACK-10247: L2 network not shared on projects (#2420)\n\nWhen trying to deploy a vm providing a project id and a L2 network id, this error is logged."}, "CLOUDSTACK-10251": {"fixed_bug_sha": "6e09529bdee0be84cb435beef0735444b3f6f692", "parent_bug_sha": "ce67726c6d3db6e7db537e76da6217c5d5f4b10e", "commit_message": "CLOUDSTACK-10251: HTTPS downloader for Direct Download templates failure (#2424)\n\nFailure on HTTPS downloader for Direct Download templates on KVM.\r\nReason: Incorrect request caused NullPointerException getting the response InputStream"}, "CLOUDSTACK-10243": {"fixed_bug_sha": "ce67726c6d3db6e7db537e76da6217c5d5f4b10e", "parent_bug_sha": "38ccbfb79c0654495ab03d54f94d3cdc481ba7c6", "commit_message": "CLOUDSTACK-10243: Do not use wait() on Python subprocess (#2421)\n\nThis might (and does block) in certain situations on the VR as\r\nalso explained in the Python documentation:\r\n\r\nhttps://docs.python.org/2/library/subprocess.html#subprocess.Popen.wait\r\n\r\n  Warning This will deadlock when using stdout=PIPE and/or stderr=PIPE\r\n  and the child process generates enough output to a pipe such that\r\n  it blocks waiting for the OS pipe buffer to accept more data.\r\n  Use communicate() to avoid that.\r\n\r\nUsing the check_output function handles most of this for us and\r\nalso provides better error handling.\r\n\r\nSigned-off-by: Wido den Hollander <wido@widodh.nl>"}, "CLOUDSTACK-10218": {"fixed_bug_sha": "8949efe8d1bf67fda0b8deaccedc2c2d4de0f246", "parent_bug_sha": "0befb2cceb8e2634adf796cd99ed89342ad03bf3", "commit_message": "CLOUDSTACK-10218: Fix for forced network update in a nuage network (#2445)\n\nFix for forced network update to a nuage network offering with vr fails with IllegalArgumentException.\r\nAddressed review comments DaanHoogland."}, "CLOUDSTACK-10269": {"fixed_bug_sha": "0befb2cceb8e2634adf796cd99ed89342ad03bf3", "parent_bug_sha": "123c20dc57d809f89bc1b012303e71b6892c8729", "commit_message": "CLOUDSTACK-10269: On deletion of role set name to null (#2444)\n\nDuring deletion of role, set name to null. This fixes concurrent\r\nexception issue where previously it would rename the deleted role\r\nwith a timestamp.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10222": {"fixed_bug_sha": "94776fbfd030528feccacdfc2d1ed85a38858f3f", "parent_bug_sha": "6ffbce6159771fb792114c39c12be6bc2a55aa70", "commit_message": "CLOUDSTACK-10222: Clean snaphosts from primary storage when taking new (#2398)\n\nWhen user creates a snapshot (manual or recurring), snapshot remains on\r\nthe primary storage, even if the snapshot is transferred successfully to\r\nsecondary storage. This is causing issues because XenServer can only hold\r\na limited number of snapshots in its VDI chain, preventing the user from\r\ncreating new snapshots after some time, when too many old snapshots are\r\npresent on the primary storage."}, "CLOUDSTACK-10259": {"fixed_bug_sha": "9aa34c409269b1c22cab1f894bbd6539d56141c6", "parent_bug_sha": "2ad520282319da9a03061b8c744e51a4ffdf94a2", "commit_message": "Merge pull request #2439 from rafaelweingartner/CLOUDSTACK-10259\n\n[CLOUDSTACK-10259] Missing float part of secondary storage data in listAccounts method"}, "CLOUDSTACK-10127": {"fixed_bug_sha": "c12e1386d336b40484512ae6e4f3b2b01a910bce", "parent_bug_sha": "f250b3ae0cf7efeef486f15474b606299d17318e", "commit_message": "CLOUDSTACK-10127: For OVS to work use dev/nic id based on mac address for KVM (#2304)\n\nThis uses mac address based referencing for nic/dev id for KVM. This fixes openvswitch (ovs) regression."}, "CLOUDSTACK-9542": {"fixed_bug_sha": "8e6d8a1cf35655523a34f0a3a0266981b447f194", "parent_bug_sha": "593ed59bcde31313adf4d8d4f7653cb48394b107", "commit_message": "CLOUDSTACK-9542: make listNics and ListUserVms return uniform NIC data (#2208)\n\nMakes listNics and ListUserVms return uniform NICs."}, "CLOUDSTACK-10173": {"fixed_bug_sha": "593ed59bcde31313adf4d8d4f7653cb48394b107", "parent_bug_sha": "d49765619dae5551e41192c4e00c324e74fa33db", "commit_message": "CLOUDSTACK-10173: Pick network rate from guest offering for VRs (#2351)\n\nPer the following doc, VR's guest/public nic should pick up network\r\nrate from its network offering:\r\nhttp://docs.cloudstack.apache.org/projects/cloudstack-administration/en/latest/service_offerings.html#network-throttling\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10200": {"fixed_bug_sha": "12f526bbfee0a76c564f1159b6c77fd5eabf6f4e", "parent_bug_sha": "0e3ddb2975d352a3af744454b0b1891b79188aee", "commit_message": "CLOUDSTACK-10200: Fix ACL_INBOUND/OUTBOUND rules for PrivateGateway (#2367)\n\nWe found bug in ACL rules for PrivateGateway for VPC\r\n\r\nAt a glance - rules not applied - switching Allow All or Deny All (default ACL) - showed as completed - but rules missed.\r\nResult - traffic via PrivateGateway blocked by next DROP rule in next chains\r\n\r\nHow to reproduce:\r\n\r\nEnable PrivateGateway for Cloudstack\r\nCreate VPC\r\nProvision new PrivateGateway inside VPC with some VLAN\r\nChange ACL (optional step to show that problem not in initial configuration but in config itself)\r\nExpected:\r\nACL rules applied (inserted) into correspondig ACL_INBOUND/OUTBOUND chanins for PrivateGateway interface (ethX) based on ACL which user choose\r\n\r\nCurrent:\r\nNo rules inserted. ACL_INBOUND/OUTBOUND_ethX - empty. Traffic blocked by next DROP rule in FORWARD chain\r\n\r\nAffect - all our corporate customers blocked with access to their own nets via PG and vice-versa.\r\n\r\nRoot cause:\r\nIssue happened because of CsNetFilter.py logic for inserting rules for ACL_INBOUND/OUTBOUND chains.\r\n\r\nWe choose rule numebr to isnert right before last DROP rule - but forget about fact - that if chain empty - we also return 0 as insert position. Which not true for iptables - numeration started from 0.\r\n\r\nSo we need very small patch to handle this special case - if number of rules inside chain equal to zero - return 1, else - return count of rules inside chain.\r\n\r\nIt's found only one - just because be default for PrivateGateway - we didn't insert any \"service rules\" (if SourceNat for PrivateGteway not ticked) - and we have by default empty ACL_INBOUND/OUTBOUND chains. Because same insert happened for all VPC networks (but when we call this insert - we already have at least 1 rule inside chains - and we successfully can process)"}, "CLOUDSTACK-10168": {"fixed_bug_sha": "80a6961b5d155b0203c41d992acc293c1428255c", "parent_bug_sha": "044636ca878901764f6e5dd7525257230257d349", "commit_message": "CLOUDSTACK-10168: VR duplicate entries in /etc/hosts when reusing VM name (#2366)\n\nBug is fixed. Fixed typo 'adress' to 'address' everywhere which leads to correct generation for agent communication json dhcp command."}, "CLOUDSTACK-9875": {"fixed_bug_sha": "cd637fd05f7c893824319c3040288166c82d6371", "parent_bug_sha": "13c325aad4484e0e41fb5b3e42a470bce0266372", "commit_message": "CLOUDSTACK-9875: Unable to re-apply Explicit dedication to VM (#2042)\n\nProblem:\r\nWhen a VM is deployed with in an Affinity group which has the cluster dedicated to a subdomain (zone is dedicated to parent domain) it is getting successful. We can also stop the vm and remove the affinity group, but if you want to add back the affinity it is failing.\r\n\r\nRoot cause:\r\nDuring VM deployment there is clear check on affinity type (account/domain). Here since the acl_type is \"domain\" it does not expect to be same owner for entities.\r\nBut during update of affinity to VM there is no specific check for acl_type \"domain\".\r\n\r\nSolution:\r\nFix is to make the access check similar to VM deployment where it does not expect to be same owner for entities if the acl_type is \"domain\"."}, "CLOUDSTACK-10195": {"fixed_bug_sha": "9179bd54d4d721c52c0f7c041cd0f5d714172073", "parent_bug_sha": "6e3495f535c86c1d3e1e0f3971335aef796d824f", "commit_message": "CLOUDSTACK-10195: CloudStack MySQL HA problem - No database selected (#2364)\n\nWhen using CloudStack with database HA configuration user receives warnings constantly saying \u201cNo database selected\u201d.\r\n\r\nThis problem happens at com.cloud.cluster.ClusterManagerImpl.getHeartbeatTask().new ManagedContextRunnable(){...}.runInContext(), line 550. The scheme of the database is not properly set in the transaction when database HA options are enabled."}, "CLOUDSTACK-10190": {"fixed_bug_sha": "6e3495f535c86c1d3e1e0f3971335aef796d824f", "parent_bug_sha": "7cb4551d7560e53aacbaabf11df21551caea39a0", "commit_message": "CLOUDSTACK-10190: Duplicate public VLAN for two different admin accounts (#2361)\n\nISSUE :\r\nDuplicate public VLAN for two different admin accounts.\r\n\r\nSTEPS TO REPRODUCE :\r\n\r\nStart multiple threads for executing createVlanIpRange API.\r\nMake sure multiple threads run in parallel.\r\nVerify vlan table in DB, duplicate entry for same VLAN and IP address range will be encountered, just id and uuid will be different, rest all fields will have similar value.\r\nFollowing entry will be observed in vlan table :\r\n`mysql> select * from vlan where vlan_id like 'vlan://77' and removed is null;\r\n+----+--------------------------------------+-----------+--------------+-----------------+---------------------------+----------------+----------------+------------+---------------------+-------------+----------+-----------+---------+---------------------+\r\n| id | uuid | vlan_id | vlan_gateway | vlan_netmask | description | vlan_type | data_center_id | network_id | physical_network_id | ip6_gateway | ip6_cidr | ip6_range | removed | created |\r\n+----+--------------------------------------+-----------+--------------+-----------------+---------------------------+----------------+----------------+------------+---------------------+-------------+----------+-----------+---------+---------------------+\r\n| 15 | 6a205b78-d162-43e3-8da9-86a3ff60f40e | vlan://77 | 10.112.63.65 | 255.255.255.192 | 10.112.63.66-10.112.63.70 | VirtualNetwork | 1 | 200 | 200 | NULL | NULL | NULL | NULL | 2017-12-13 12:55:51 |\r\n| 17 | ff8b5175-b247-45a5-b8d3-feb6a1ca64d0 | vlan://77 | 10.112.63.65 | 255.255.255.192 | 10.112.63.66-10.112.63.70 | VirtualNetwork | 1 | 200 | 200 | NULL | NULL | NULL | NULL | 2017-12-13 12:55:51 |\r\n+----+--------------------------------------+-----------+--------------+-----------------+---------------------------+----------------+----------------+------------+---------------------+-------------+----------+-----------+---------+---------------------+"}, "CLOUDSTACK-10198": {"fixed_bug_sha": "7cb4551d7560e53aacbaabf11df21551caea39a0", "parent_bug_sha": "a37204079847d5f7aba03f05378a8c6a8a902f5e", "commit_message": "CLOUDSTACK-10198: removed unused (#1437)\n\ncom.cloud.hypervisor.hyperv.resource.HypervDummyResourceBase\r\nclass and change the log message in\r\ncom.cloud.hypervisor.hyperv.discoverer.HypervServerDiscoverer"}, "CLOUDSTACK-9800": {"fixed_bug_sha": "49be7eecd2e7db33a421b8680e4e8806a3d63952", "parent_bug_sha": "1edb3e8a450079e9f027f159ee7b8fa31e39b591", "commit_message": "CLOUDSTACK-9800: Enabled netscaler inline mode. Added corrsponding changes in UI (#1964)\n\nNetScaler can work in inline mode also along with other Firewall devices. Enabled netscaler inline mode capability"}, "CLOUDSTACK-8908": {"fixed_bug_sha": "566238b08ed7ff7d496368db9fb8bd9f5127db76", "parent_bug_sha": "47419df368336b089814d66f4a70afeae9e1ba47", "commit_message": "CLOUDSTACK-8908: After copying the template charging for that template is stopped (#2308)\n\nWhen a template is copied back to zone after it is deleted. deleted field gets reset to null. delete field is added to Search on template zone mapping table to take care of the existing mapping."}, "CLOUDSTACK-9839": {"fixed_bug_sha": "b417226d058a9667c6fdb582615c826d46c342e1", "parent_bug_sha": "44a7eb0d141564ac6f9d827ce1f460b9cbd653c0", "commit_message": "CLOUDSTACK-9839: Add XenServer 7.1 and 7.2 interoperablility (#2346)\n\nAdds XenServer 7.1 and 7.2 interoperablility.\r\nAdds hypervisor to capabilities list and add guest OS mappings (copied from 7.0.0 mappings initially).\r\nAdd newly supported OSes and remove deprecated ones (XenServer)"}, "CLOUDSTACK-10176": {"fixed_bug_sha": "44a7eb0d141564ac6f9d827ce1f460b9cbd653c0", "parent_bug_sha": "fc49533a8e3b52d1be296022832231ad22e40bd0", "commit_message": "CLOUDSTACK-10176: VM Start Api Job returns success for failed Job (#2354)\n\nISSUE :\r\n\r\nVM start API Job returns success for failed Job\r\n\r\nSTEPS TO REPRODUCE :\r\n\r\nStop VM instance.\r\nMark state of associate router as Stopping from DB\r\nExecute startVirtualMachine Api from rest client.\r\nVM will not start but still main job will return the status as SUCCEEDED, whereas sub-job for command VmWorkStart will return status as failed."}, "CLOUDSTACK-9986": {"fixed_bug_sha": "fc49533a8e3b52d1be296022832231ad22e40bd0", "parent_bug_sha": "d57b518727e5121b9e48f1b3e1af721144f6d9ad", "commit_message": "CLOUDSTACK-9986: Use host table to iterate for zone/cluster metrics (#2353)\n\nThe host_view may contain duplicate entries when hosts have tags.\r\nChanging the host_view may cause unseen regressions so\r\nto fix the issues we've modified the zone/cluster metrics code to use\r\nthe `host` table (hostdao) to iterate through the list of hosts in a\r\ncluster during zone/cluster metrics listing.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-9736": {"fixed_bug_sha": "895aee37f7da33034c66e209b404f135f49d6279", "parent_bug_sha": "bac423fea082febd4bc3522aa85f7bbb594f2562", "commit_message": "CLOUDSTACK-9736: Incoherent validation and error message when you change the vm.password.length configuration parameter (#2358)\n\nDefault value introduce in schema-430to440.sql are 6 for the length\r\n\r\nCLOUDSTACK-10111 have already the error message."}, "CLOUDSTACK-10184": {"fixed_bug_sha": "bac423fea082febd4bc3522aa85f7bbb594f2562", "parent_bug_sha": "e5f0a68a4d5cbd520b9043a1e62959328a52f2af", "commit_message": "CLOUDSTACK-10184: Re-work method QuotaResponseBuilderImpl.startOfNextDay (#2326)\n\nAlso, removed @Local annotation that is not needed and add test cases."}, "CLOUDSTACK-10077": {"fixed_bug_sha": "e5f0a68a4d5cbd520b9043a1e62959328a52f2af", "parent_bug_sha": "8c6fb0e3120e80e0682b5666b13e70d640e58daf", "commit_message": "CLOUDSTACK-10077: allow to have different VPN customer gateway configs for same gateway IP (#2267)\n\nRelated https://github.com/apache/cloudstack/commit/86bbe211f2341d52d1d64b0b6d3abcdcef85d3ee and CLOUDSTACK-494. Currently we can not have serveral VPCs in one account with different VPN customer gateways configuration per same gateway IP."}, "CLOUDSTACK-10157": {"fixed_bug_sha": "8c6fb0e3120e80e0682b5666b13e70d640e58daf", "parent_bug_sha": "be3a39ea4fcb1f758d72c4e4abc43f428845c4d1", "commit_message": "CLOUDSTACK-10157: Wrong notification while migration (#2337)\n\nRoot Cause:\r\nEarlier, it was failing with ArrayIndexOutOfBoundsException, when the list is empty and accessing the first element.\r\nThe error was only observed in Log, but was not showing in UI as it was not throwing any exception.\r\nHence the API call was in turn successful.\r\n\r\nSolution:\r\nAdded the empty check before sending device details.\r\nWhich says either the required GPU device is not available or out of capacity."}, "CLOUDSTACK-10331": {"fixed_bug_sha": "3e62ce9c1b394a4a4da5d7d04a549f1be77ed9b3", "parent_bug_sha": "cd3a128090626d4afb991d7b7667d25da8ee950f", "commit_message": "CLOUDSTACK-10331: Remove reference to deleted script vm_snapshots.js (#2497)"}, "CLOUDSTACK-10231": {"fixed_bug_sha": "6a754237797a9d2f084674da83929f66fd402368", "parent_bug_sha": "1ad04cbc9b165411b2e0c01cce598f1ef52b7b41", "commit_message": "CLOUDSTACK-10231: Asserted fixes for Direct Download on KVM (#2408)\n\nSeveral fixes addressed:\r\n\r\n- Dettach ISO fails when trying to detach a direct download ISO\r\n- Fix for metalink support on SSVM agents (this closes CLOUDSTACK-10238)\r\n- Reinstall VM from bypassed registered template (this closes CLOUDSTACK-10250)\r\n- Fix upload certificate error message even though operation was successful\r\n- Fix metalink download, checksum retry logic and metalink SSVM downloader"}, "CLOUDSTACK-10296": {"fixed_bug_sha": "ab0bce2a1baa4e199a447e3f2d74ca93c026a037", "parent_bug_sha": "74db647dbbaa224ffa5667a3203d53f48532d072", "commit_message": "CLOUDSTACK-10296: Find time different from last timestamp (#2458)\n\nThis fixes a difference issue in rVR heartbeat check script raised\r\nrecently on dev@.\r\nReduce logging to avoid logging to fill ramdisk\r\nMake checkrouter return fault state when keepalived is not running\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-8855": {"fixed_bug_sha": "972b8b71d7fb60a64e8a05e7555f9f92ede7ff40", "parent_bug_sha": "989e4e29dc2c03b885e8fb604a869b343577f870", "commit_message": "CLOUDSTACK-8855 Improve Error Message for Host Alert State and reconnect host API. (#2387)\n\n* CLOUDSTACK-8855 Improve Error Message for Host Alert State\r\n\r\n* [CLOUDSTACK-9846] create column to save the content of alert messages\r\n\r\nRemove declaration of throws CloudRuntimeException\r\nI also removed some unused variables and comments left behind\r\n\r\nThis closes #837\r\n\r\n* Isolate a problematic test \"smoke/test_certauthority_root\""}, "CLOUDSTACK-10321": {"fixed_bug_sha": "74db647dbbaa224ffa5667a3203d53f48532d072", "parent_bug_sha": "19d6578732311872d8232276e248e509bf730a82", "commit_message": "CLOUDSTACK-10321: CPU Cap for KVM (#2482)"}, "CLOUDSTACK-10319": {"fixed_bug_sha": "c4cc679c3b34a5f38cc17a01a96e9d69aa370641", "parent_bug_sha": "c8dcc64b6534f3e035ebc8597c38591e40009ea5", "commit_message": "CLOUDSTACK-10319: Allow TLSv1, v1.1 for XenServer, Vmware (#2507)\n\nThis reverts changes from #2480, instead moves TLS settings to\r\njava ciphers settings config file. It should be sufficient to enforce\r\nTLS v1.2 on public facing CloudStack services:\r\n- CloudStack webserver (Jetty based)\r\n- Apache2 for secondary storage VM\r\n- CPVM HTTPs server\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10317": {"fixed_bug_sha": "c0440e8124666fe7c642d8875870b7c09b65ce42", "parent_bug_sha": "c0b920f740f5e5ba33f0e210caf4642edb2b7224", "commit_message": "CLOUDSTACK-10317: Fix SNAT rules for additional public nics (#2476)\n\n* CLOUDSTACK-10317: Fix SNAT rules for additional public nics\r\n\r\nThis allows networks with additional public nics to have correct\r\nSNAT iptables rules applied on configuration.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>\r\n\r\n* update based on Wei's suggested change\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10274": {"fixed_bug_sha": "c0b920f740f5e5ba33f0e210caf4642edb2b7224", "parent_bug_sha": "0bb20a7ed27865c01f81bca191e6347c32be9c4c", "commit_message": "CLOUDSTACK-10274: L2 network refused to be designed on VXLAN physical network (#2448)\n\nL2 network refused to be designed on VXLAN physical network. Add fix for vxlan issue.\r\nAdd condition for L2 networks which do not allow specifying vlan."}, "CLOUDSTACK-10318": {"fixed_bug_sha": "4412563f19ec8b808fe4c79e2baf658507a84873", "parent_bug_sha": "2037dc9eb3979cbefc0a1c7f8b927c8d8b53ac26", "commit_message": "[CLOUDSTACK-10318] Bug on sorting ACL rules list in chrome (#2478)"}, "CLOUDSTACK-10054": {"fixed_bug_sha": "bb607d07a97476dc4fb934b3d75df6affba47086", "parent_bug_sha": "cdddecb41ef74ae8f3b2a67c03b7c7be20f2bb2d", "commit_message": "CLOUDSTACK-10054:Volume download times out in 3600 seconds (#2244)"}, "CLOUDSTACK-10306": {"fixed_bug_sha": "5c2b8f80f02ae9459537b32ac2bece3e765032ef", "parent_bug_sha": "3dfbcbc48a6b3eab906b1a52fc50e44de2479636", "commit_message": "CLOUDSTACK-10306: Upgrade to VMware 6.5 vim jar dependency (#2467)\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10298": {"fixed_bug_sha": "3dfbcbc48a6b3eab906b1a52fc50e44de2479636", "parent_bug_sha": "0ece15f86ea1037eb36c25251d88a3cadd2791a9", "commit_message": "CLOUDSTACK-10298: fix for recreation of an earlier deleted Nuage managed network (#2460)\n\n* CLOUDSTACK-10298: Recreation of an earlier deleted Nuage managed isolated or vpc tier network fails\r\n\r\nAdded negative tests for feature vsd managed subnets\r\nAdded fixes for reacreation of an earlier deleted Nuage managed network\r\nUpdated Nuage Vsp CloudStack client to 1.0.8\r\nCo-authored by: Sigert Goeminne <sigert.goeminne@nuagenetworks.net>\r\n\r\n* removed commented code as per review comment"}, "CLOUDSTACK-10344": {"fixed_bug_sha": "685cc7210c2f6396beb649cd1fb789957a6cdb66", "parent_bug_sha": "5d9ae35506f4765f9facbc1f7c865407652e9933", "commit_message": "[CLOUDSTACK-10344] bug when moving ACL rules (change order with drag and drop) (#2511)\n\n* Add permission to 'moveNetworkAclItem' API method in default roles"}, "CLOUDSTACK-10304": {"fixed_bug_sha": "e71d4d4371fdf1595bb42f152ec544243f2087f2", "parent_bug_sha": "5d05da21effad48e210303b4dae5385b6ed85d2c", "commit_message": "CLOUDSTACK-10304: turn off apache2 server tokens and signature in systemvms (#2563)\n\n* systemvm: turn off apache2 server tokens and signature\r\n\r\nThis turns off apache2 server version signature/token in headers.\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>\r\n\r\n* systemvm: remove invalid code as conf.d is not available now\r\n\r\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}, "CLOUDSTACK-10214": {"fixed_bug_sha": "eba2e1d8a1ce4e86b4df144db03e96739da455e5", "parent_bug_sha": "0e8fbdb35f366e73766b8970b0f08a2bea761ad0", "commit_message": "[CLOUDSTACK-10214] Unable to remove local primary storage (#2390)"}, "CLOUDSTACK-10230": {"fixed_bug_sha": "91d98211496a482e6882acd6528f9b8dbeefe3bf", "parent_bug_sha": "bbc92046655bc528846090eddf1fc38abd2da90a", "commit_message": "[CLOUDSTACK-10230] User should not be able to use removed \u201cGuest OS type\u201d (#2404)\n\n* [CLOUDSTACK-10230] User is able to change to \u201cGuest OS type\u201d that has been removed\r\n\r\nUsers are able to change the OS type of VMs to \u201cGuest OS type\u201d that has been removed. This becomes a security issue when we try to force users to use HVM VMs (Meltdown/Spectre thing). A removed \u201cguest os type\u201d should not be usable by any users in the cloud."}, "CLOUDSTACK-10226": {"fixed_bug_sha": "bbc92046655bc528846090eddf1fc38abd2da90a", "parent_bug_sha": "b08f9e053ff301d59dc81283704be37dc1871905", "commit_message": "[CLOUDSTACK-10226] CloudStack is not importing Local storage properly (#2401)\n\n* [CLOUDSTACK-10226] CloudStack is not importing Local storage properly\r\n\r\nCloudStack is importing as Local storage any XenServer SR that is of type LVM or EXT. This causes a problem when one wants to use both Direct attach storage and local storage. Moreover, CloudStack was not importing all of the local storage that a host has available when local storage is enabled. It was only importing the First SR it sees.\r\n\r\nTo fix the first problem we started ignoring SRs that have the flag shared=true when discovering local storages. SRs configured to be shared are used as direct attached storage, and therefore should not be imported again as local ones.\r\nTo fix the second problem, we started loading all Local storage and importing them accordingly to ACS.\r\n\r\n* Cleanups and formatting"}, "CLOUDSTACK-10301": {"fixed_bug_sha": "b08f9e053ff301d59dc81283704be37dc1871905", "parent_bug_sha": "50042680b00d3ed9baabf17c6b6a53764a9b3603", "commit_message": "[CLOUDSTACK-10301] Allow updating the network ACL list name and Description (#2462)\n\n* [CLOUDSTACK-10301] Allow updating the network ACL list name and description\r\n\r\n* Fixes suggested by Daan"}, "CLOUDSTACK-10287": {"fixed_bug_sha": "cff4032f001a17f25346da3141ac7da5f5dcce7f", "parent_bug_sha": "23ae6762bdcd5920bc8a97372c1a75e7f860a161", "commit_message": "CLOUDSTACK-10287 package require open jdk 1.8 (#2519)"}, "CLOUDSTACK-10241": {"fixed_bug_sha": "060715e9f5f929804b7f515cfba0b4b130581876", "parent_bug_sha": "386888654603c936310665a30fdd0208b86a3fcd", "commit_message": "[CLOUDSTACK-10241] Duplicated file SRs being created in XenServer pools (#2414)\n\n* [CLOUDSTACK-10241] Duplicated file SRs being created in XenServer pools\r\n\r\nDue to a race condition between multiple management servers, in some rare cases, CloudStack is creating multiple file SRs to the same secondary folder. This causes a problem when introducing the SR to the XenServer pools, as \u201cthere will be VDIs with duplicated UUIDs\u201c. The VDIs are the same, but they are seen in different SRs, and therefore cause an error.\r\n\r\nThe solution to avoid race conditions between management servers is to use a deterministic srUuid for the file SR to be created (we are leaving XenServer with the burden of managing race conditions). The UUID is based on the SR file path and is generated using  UUID#nameUUIDFromBytes. Therefore, if there is an SR with the generated UUID, this means that some other management server has just created it. An exception will occur and it will contain a message saying 'Db_exn.Uniqueness_constraint_violation'. In these unlikely events, we catch the exception and use the method retrieveAlreadyConfiguredSrWithoutException to get the SR that has already been created for the given mount point."}, "CLOUDSTACK-10278": {"fixed_bug_sha": "7647e104b28a9fd0ee3dbdc7b2fa2db8bd29fb73", "parent_bug_sha": "986ecfa7e99d0f29b4d7b3cd8065da31695ec00b", "commit_message": "CLOUDSTACK-10278 idempotent column addition (#2449)\n\n* CLOUDSTACK-10278 - WIP: need to test this script before create a pull request\r\n\r\n* CLOUDSTACK-10278 - added more idempotent stored procs and moved all lines, that end with a semicolon in existing proc, onto one line because com/cloud/utils/db/ScriptRunner.java executes the sql as soon as it reads in line with a semicolon delimeter at the end.\r\n\r\n* CLOUDSTACK-10278 - changed more sql statements to call idempotent stored procs\r\n\r\n* CLOUDSTACK-10278 - WIP: need to test this script before create a pull request\r\n\r\n* CLOUDSTACK-10278 - added more idempotent stored procs and moved all lines, that end with a semicolon in existing proc, onto one line because com/cloud/utils/db/ScriptRunner.java executes the sql as soon as it reads in line with a semicolon delimeter at the end.\r\n\r\n* CLOUDSTACK-10278 - changed more sql statements to call idempotent stored procs"}, "CLOUDSTACK-10320": {"fixed_bug_sha": "ca1760a46b67004d049b34ffbae4b635ec0a1561", "parent_bug_sha": "9753cc3681b4dd31a9e409897f89228fb3fbd562", "commit_message": "CLOUDSTACK-10320 - Invalid pair for response object breaking response parsing (#2481)"}}}]